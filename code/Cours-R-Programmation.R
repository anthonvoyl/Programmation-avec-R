## ----setup, include=FALSE----------------------------------------------------------------------------------------------
knitr::opts_chunk$set(echo = TRUE, tidy=TRUE)
options(width = 80)
summarytools::st_options(plain.ascii = FALSE, style = "rmarkdown")

def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  paste0("\n \\", "tiny","\n\n", x, "\n\n \\normalsize")
})


## ----------------------------------------------------------------------------------------------------------------------
a <- 1
class(a)


## ----------------------------------------------------------------------------------------------------------------------
class(a) <- c("truc","machin")
class(a)


## ----------------------------------------------------------------------------------------------------------------------
d <- Sys.Date()
d


## ----------------------------------------------------------------------------------------------------------------------
storage.mode(d)


## ----------------------------------------------------------------------------------------------------------------------
i <- 12L
storage.mode(i)


## ----------------------------------------------------------------------------------------------------------------------
12


## ----------------------------------------------------------------------------------------------------------------------
'abcd'


## ----------------------------------------------------------------------------------------------------------------------
sum


## ----------------------------------------------------------------------------------------------------------------------
TRUE


## ----eval=TRUE---------------------------------------------------------------------------------------------------------
library(rio)
fichier <- "/home/alex/Devel/Cours-R-Programmation/data/dpt2022.csv"
import(fichier, as.is=TRUE)


## ----------------------------------------------------------------------------------------------------------------------
1+1
a <- 1


## ----eval=TRUE---------------------------------------------------------------------------------------------------------
library(tidyr)
fichier %>% import(as.is=TRUE)


## ----------------------------------------------------------------------------------------------------------------------
e <- parse(text="6*7")
e


## ----------------------------------------------------------------------------------------------------------------------
as.list(e[[1]])


## ----------------------------------------------------------------------------------------------------------------------
eval(e)


## ----------------------------------------------------------------------------------------------------------------------
eval({ xx <- pi; xx^2})
xx


## ----------------------------------------------------------------------------------------------------------------------
e <- quote(6*7)
e


## ----------------------------------------------------------------------------------------------------------------------
class(e)


## ----------------------------------------------------------------------------------------------------------------------
eval(e)


## ----out.width="70%", fig.align='center', message=FALSE----------------------------------------------------------------
library(ggformula)
g <- mtcars %>% gf_bar( ~ cyl, fill="blue") + theme_minimal()
g


## ----------------------------------------------------------------------------------------------------------------------
x <- 6 * 7


## ----------------------------------------------------------------------------------------------------------------------
(x <- 6*7)


## ----------------------------------------------------------------------------------------------------------------------
6*print(7)


## ----------------------------------------------------------------------------------------------------------------------
invisible(6*print(7))


## ----------------------------------------------------------------------------------------------------------------------
prenoms2022 <- import("../data/dpt2022.csv", as.is=TRUE)


## ----------------------------------------------------------------------------------------------------------------------
prenoms2022b <- prenoms2022


## ----------------------------------------------------------------------------------------------------------------------
prenoms2022 <- import("../data/dpt2022.csv", as.is=TRUE)


## ----------------------------------------------------------------------------------------------------------------------
ls()


## ----------------------------------------------------------------------------------------------------------------------
as.character(quote(x))


## ----------------------------------------------------------------------------------------------------------------------
as.name("x")


## ----------------------------------------------------------------------------------------------------------------------
x <- 42
get("x")


## ----eval=FALSE--------------------------------------------------------------------------------------------------------
## get(x)


## ----------------------------------------------------------------------------------------------------------------------
assign("x",pi)


## ----eval=FALSE--------------------------------------------------------------------------------------------------------
## nanopop %>% mutate(sexe2=as.numeric(sexe))


## ----eval=FALSE--------------------------------------------------------------------------------------------------------
## nanopop %>% mutate(sexe2=as.numeric(sexe)) -> nanopop


## ----------------------------------------------------------------------------------------------------------------------
1

## ----------------------------------------------------------------------------------------------------------------------
a <- 1 
class(a)


## ----------------------------------------------------------------------------------------------------------------------
b <- 1L
class(b)


## ----------------------------------------------------------------------------------------------------------------------
a == b

## ----------------------------------------------------------------------------------------------------------------------
c <- FALSE
class(c)


## ----------------------------------------------------------------------------------------------------------------------
d <- 'Je suis une chaîne de caractères'
class(d)


## ----------------------------------------------------------------------------------------------------------------------
as.raw(2)


## ----------------------------------------------------------------------------------------------------------------------
charToRaw("a")


## ----------------------------------------------------------------------------------------------------------------------
a <- 1
is.vector(a)


## ----------------------------------------------------------------------------------------------------------------------
length(a)


## ----------------------------------------------------------------------------------------------------------------------
b <- c(1,2)
class(b)


## ----------------------------------------------------------------------------------------------------------------------
length(b)


## ----------------------------------------------------------------------------------------------------------------------
42


## ----------------------------------------------------------------------------------------------------------------------
v <- logical(0)
v
length(v)


## ----------------------------------------------------------------------------------------------------------------------
vector("complex",5)


## ----------------------------------------------------------------------------------------------------------------------
c(6,7)


## ----------------------------------------------------------------------------------------------------------------------
rep(TRUE,5)



## ----------------------------------------------------------------------------------------------------------------------
1:10


## ----------------------------------------------------------------------------------------------------------------------
(v <- 101:110)



## ----------------------------------------------------------------------------------------------------------------------
v[3:5]


## ----------------------------------------------------------------------------------------------------------------------
v[5:3]


## ----------------------------------------------------------------------------------------------------------------------
v[-3:-5]


## ----------------------------------------------------------------------------------------------------------------------
v[c(TRUE,rep(FALSE,8),TRUE)]


## ----------------------------------------------------------------------------------------------------------------------
PARITE <- 1
v[(v %% 2)==PARITE]


## ----------------------------------------------------------------------------------------------------------------------
v %% 2


## ----------------------------------------------------------------------------------------------------------------------
(v %% 2)==PARITE


## ----------------------------------------------------------------------------------------------------------------------
x <- seq(2,12,2)
x 


## ----------------------------------------------------------------------------------------------------------------------
all(x %% 2 == 0)


## ----------------------------------------------------------------------------------------------------------------------
any(x %% 2 != 0)


## ----------------------------------------------------------------------------------------------------------------------
sum( x > 6)


## ----------------------------------------------------------------------------------------------------------------------
seq(1,50,5)[1:5]


## ----echo=FALSE--------------------------------------------------------------------------------------------------------
v <- Sys.Date()+ 0:6
weekdays(v)


## ----------------------------------------------------------------------------------------------------------------------
LETTERS


## ----------------------------------------------------------------------------------------------------------------------
which(LETTERS>="N" & LETTERS<="P")


## ----------------------------------------------------------------------------------------------------------------------
LETTERS[which(LETTERS>="N" & LETTERS<="P")]


## ----------------------------------------------------------------------------------------------------------------------
LETTERS[LETTERS>="N" & LETTERS<="P"]


## ----------------------------------------------------------------------------------------------------------------------
1:10 + rep(100,10)


## ----------------------------------------------------------------------------------------------------------------------
1:10 + 100


## ----------------------------------------------------------------------------------------------------------------------
1:10 + rep(100,11)


## ----------------------------------------------------------------------------------------------------------------------
1:10 + c(100,200)


## ----------------------------------------------------------------------------------------------------------------------
library(dplyr)
mtcars %>% filter(cyl=="6")

## ----------------------------------------------------------------------------------------------------------------------
mtcars %>% filter(cyl==c("6","4"))


## ----------------------------------------------------------------------------------------------------------------------
mtcars %>% filter(cyl %in% c("6","4"))


## ----------------------------------------------------------------------------------------------------------------------
v <- c("un","deux","trois","quatre","cinq")
w <- 1:4
paste0(v,w)


## ----------------------------------------------------------------------------------------------------------------------
paste(v,w)


## ----------------------------------------------------------------------------------------------------------------------
paste(v, collapse=";")


## ----------------------------------------------------------------------------------------------------------------------
v <- 101:110
v[3:5] <- 0
v


## ----------------------------------------------------------------------------------------------------------------------
v[12] <- 12
v


## ----------------------------------------------------------------------------------------------------------------------
v <- v[-2]
v


## ----------------------------------------------------------------------------------------------------------------------
m <- c(0,5,4,9,3,0,0,1,2,7)
dim(m) <- c(2,5)
m


## ----------------------------------------------------------------------------------------------------------------------
m[2,5]


## ----------------------------------------------------------------------------------------------------------------------
m[2,]


## ----------------------------------------------------------------------------------------------------------------------
m[,2]


## ----------------------------------------------------------------------------------------------------------------------
m>4


## ----------------------------------------------------------------------------------------------------------------------
m[m>4]


## ----------------------------------------------------------------------------------------------------------------------
m * 2


## ----------------------------------------------------------------------------------------------------------------------
m - m


## ----------------------------------------------------------------------------------------------------------------------
rowSums(m)


## ----------------------------------------------------------------------------------------------------------------------
colSums(m)


## ----------------------------------------------------------------------------------------------------------------------
m[, colSums(m)>5]


## ----------------------------------------------------------------------------------------------------------------------
liste <- list(a=1, 3L, "a", TRUE, f=sum, l=list(1, 2))


## ----------------------------------------------------------------------------------------------------------------------
str(liste)


## ----------------------------------------------------------------------------------------------------------------------
liste[[5]]


## ----------------------------------------------------------------------------------------------------------------------
liste[["f"]]


## ----------------------------------------------------------------------------------------------------------------------
liste$f


## ----------------------------------------------------------------------------------------------------------------------
liste[5]


## ----------------------------------------------------------------------------------------------------------------------
liste[-1:-2]


## ----------------------------------------------------------------------------------------------------------------------
liste <- list(1,2)
liste[[2]]<- -1
liste[[4]]<- -2
liste


## ----------------------------------------------------------------------------------------------------------------------
liste2 <- list()
liste2$a <- 1


## ----------------------------------------------------------------------------------------------------------------------
list(1, 2, 3) %>% unlist()


## ----------------------------------------------------------------------------------------------------------------------
list(1, "a") %>% unlist()


## ----------------------------------------------------------------------------------------------------------------------
list(1, list(2,3)) %>% unlist()


## ----------------------------------------------------------------------------------------------------------------------
list(a=1, b=2, c=3) %>% unlist()


## ----------------------------------------------------------------------------------------------------------------------
liste <- list(a=1,b=2)
is.vector(liste)


## ----message=FALSE-----------------------------------------------------------------------------------------------------
library(pryr)

inspect(liste)


## ----echo=FALSE, eval=FALSE--------------------------------------------------------------------------------------------
## library(xml2)
## library(XML)
## 
## carburant <- read_xml("../data/PrixCarburants_quotidien_20231211.xml")
## 
## carburant_xml <- xmlParse(carburant)
## # carburant_xml
## 
## pdv <- xml_find_all(carburant, ".//pdv")
## pdv[1]
## 
## df_carburant <- xmlToDataFrame(nodes = getNodeSet(carburant_xml, ".//pdv"))
## df_carburant


## ----echo=FALSE--------------------------------------------------------------------------------------------------------
con <- file("../data/PrixCarburants_quotidien_20231211.xml", encoding = "latin1")
carburants <- readLines(con)
close(con)
unique(Encoding(carburants))


## ----------------------------------------------------------------------------------------------------------------------
head(carburants)


## ----------------------------------------------------------------------------------------------------------------------
library(stringr)
carburants <- carburants[str_detect(carburants, "pdv ")]
head(carburants)


## ----------------------------------------------------------------------------------------------------------------------
carburants <- str_replace_all(carburants,"  <pdv " , "")
carburants <- carburants %>% str_replace_all(paste0(' */?>'),"") %>% str_replace_all("\"","")

head(carburants)


## ----eval=FALSE--------------------------------------------------------------------------------------------------------
## str_detect(arg,"^0") # commence par ‘0’
## str_detect(arg,"0$") # se termine par ‘0’
## str_detect(arg,"^\\$") # commence par ‘$’ non interprété
## 
## str_detect(arg,"^.0") # commence par n’importe quel caractère puis un 0
## str_detect(arg,"^[1-6]") # commence par un caractère de ‘1’ à ‘6’
## str_detect(arg,"^[1-68]") # commence par un caractère de ‘1’ à ‘6’ ou un ‘8’
## str_detect(arg,"^[^1-6]") # commence par tout sauf un caractère de ‘1’ à ‘6’
## str_detect(arg,"^\\d") # commence par un chiffre décimal
## 
## str_detect(arg,"^.*9") # commence par 0 et + caractères quelconques puis un 9
## str_detect(arg,"^.+9") # commence par 1 et + caractères quelconques puis un 9
## str_detect(arg,"^01?") # commence par 0 et éventuellement un 1
## str_detect(arg,"^0(19)?") # commence par 0 et éventuellement le groupe ‘19’
## str_detect(arg,"^(19|20)")# commence par ‘19’ ou ‘20’


## ----------------------------------------------------------------------------------------------------------------------
data(iris)
iris


## ----------------------------------------------------------------------------------------------------------------------
is.vector(iris$Sepal.Length)


## ----------------------------------------------------------------------------------------------------------------------
data(mtcars)
head(mtcars)


## ----------------------------------------------------------------------------------------------------------------------
colnames(mtcars)


## ----------------------------------------------------------------------------------------------------------------------
rownames(mtcars)


## ----------------------------------------------------------------------------------------------------------------------
mtcars[mtcars$hp>100 & mtcars$cyl==4,]


## ----------------------------------------------------------------------------------------------------------------------
mtcars[1,c("hp","cyl")]


## ----------------------------------------------------------------------------------------------------------------------
mtcars[1,startsWith(colnames(mtcars),"c")]


## ----------------------------------------------------------------------------------------------------------------------
mtcars$hp


## ----------------------------------------------------------------------------------------------------------------------
mtcars[["hp"]][1:10]


## ----------------------------------------------------------------------------------------------------------------------
cyl <- "n'importe quoi"
with(mtcars,mtcars[(cyl==6)&(hp>150),])


## ----------------------------------------------------------------------------------------------------------------------
mtcars %>% with(.[(cyl==6)&(hp>150),])


## ----------------------------------------------------------------------------------------------------------------------
df <- read.table(h=TRUE, text=
"x  y z
un  1 NA
deux  NA  2")
df


## ----------------------------------------------------------------------------------------------------------------------
df[df$x=="un","z"] <- 2
df


## ----------------------------------------------------------------------------------------------------------------------
df$z[df$x=="un"]<- 1
df


## ----------------------------------------------------------------------------------------------------------------------
df[df$x=="un",c("y","z")] <- 0
df


## ----------------------------------------------------------------------------------------------------------------------
df$new<- "a"
df


## ----message=FALSE-----------------------------------------------------------------------------------------------------
library(tidyr)
mtcars %>% as_tibble() -> a
a


## ----------------------------------------------------------------------------------------------------------------------
rownames(a)


## ----------------------------------------------------------------------------------------------------------------------
class(a)


## ----------------------------------------------------------------------------------------------------------------------
as.data.frame(a)


## ----------------------------------------------------------------------------------------------------------------------
Somme <- function(début,fin)
  sum(c(-1,1)*(début:fin)^2)


## ----------------------------------------------------------------------------------------------------------------------
Somme(1,100)

